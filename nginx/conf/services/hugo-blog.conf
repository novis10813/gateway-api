# Hugo 靜態部落格服務配置
# 包含主頁面、靜態資源和網站圖標的處理

# Hugo 網站服務
location /blog {
    limit_req zone=default_limit burst=10 nodelay;
    
    set $upstream_hugo hugo;
    proxy_pass http://$upstream_hugo:1313;
    
    # 引入標準代理頭部設定
    include /etc/nginx/conf.d/templates/proxy-headers.conf;
    
    # Hugo 特殊配置
    proxy_set_header X-Forwarded-Host $host;
    proxy_set_header X-Forwarded-Server $host;
    proxy_buffering off;
    
    # 處理靜態資源
    proxy_redirect off;
}

# Hugo 靜態資源 (CSS, JS, 圖片等)
location /blog/assets/ {
    limit_req zone=default_limit burst=20 nodelay;
    
    set $upstream_hugo hugo;
    proxy_pass http://$upstream_hugo:1313;
    
    # 引入標準代理頭部設定
    include /etc/nginx/conf.d/templates/proxy-headers.conf;
    
    # 靜態資源快取
    expires 1y;
    add_header Cache-Control "public, immutable";
}

# 處理網站圖標文件 - 代理到 Hugo 靜態文件
location ~ ^/(apple-touch-icon\.png|favicon\.ico|favicon-16x16\.png|favicon-32x32\.png|android-chrome-192x192\.png|android-chrome-512x512\.png|site\.webmanifest)$ {
    limit_req zone=default_limit burst=20 nodelay;
    
    set $upstream_hugo hugo;
    proxy_pass http://$upstream_hugo:1313;
    
    # 引入標準代理頭部設定
    include /etc/nginx/conf.d/templates/proxy-headers.conf;
    
    # 靜態資源快取
    expires 1y;
    add_header Cache-Control "public, immutable";
}

# 服務狀態端點 - 重新導向到 blog
location = / {
    return 301 /blog;
}
