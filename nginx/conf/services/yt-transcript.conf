# YouTube Transcript API 服務配置
# 包含 API Key 認證和路徑重寫

location /api/transcript {
    limit_req zone=api_limit burst=20 nodelay;
    
    set $service_name "yt-transcript";
    auth_request /auth-internal;
    error_page 401 = @auth_error;
    error_page 403 = @auth_error;

    set $upstream_transcript yt-transcript-api;
    # 所有請求都重寫到 /api/v1/transcript/
    rewrite ^/api/transcript/(.*)$ /api/v1/transcript/$1 break;
    proxy_pass http://$upstream_transcript:8000;
    
    # 引入標準代理頭部設定
    include /etc/nginx/conf.d/templates/proxy-headers.conf;
}
