# 主要 HTTPS 伺服器配置
# 處理所有 HTTPS 流量和服務路由

server {
    listen 443 ssl;
    server_name novis.tplinkdns.com;

    # 引入 SSL 參數配置
    include /etc/nginx/conf.d/global/ssl-params.conf;

    # 全域地理位置限制 - 只允許台灣 IP
    if ($is_taiwan_ip = 0) {
        return 403 '{"error": "Access denied", "message": "Access is restricted to Taiwan only", "client_ip": "$remote_addr"}';
    }

    # 日誌配置
    access_log /var/log/nginx/access.log detailed;
    error_log /var/log/nginx/error.log warn;

    # 引入安全配置
    include /etc/nginx/conf.d/security/*.conf;

    # 引入所有服務配置
    include /etc/nginx/conf.d/services/*.conf;
}
